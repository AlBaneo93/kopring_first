apiVersion : v1
kind :       Namespace
metadata :
  name : kopring-ns
#---
#apiVersion : v1
#kind :       Service
#metadata :
#  name :      nginx-service
#  labels :
#    app : kopring
#  namespace : kopring-ns
#spec :
#  ports :
#    - port :       80
#      targetPort : 80
#      protocol :   TCP
#      name :       nginx-port
#  selector :
#    app : kopring-back
#  type : NodePort
---
apiVersion : v1
kind :       Service
metadata :
  name :      back-service
  labels :
    app : kopring
  namespace : kopring-ns
spec :
  ports :
    - port :       8080
      targetPort : 8080
      protocol :   TCP
      name :       kopring-port
  selector :
    app : kopring-back
  type : NodePort
---
apiVersion : v1
kind :       Service
metadata :
  name :      redis-service
  labels :
    app : redis
  namespace : kopring-ns
spec :
  ports :
    - port :       6379
      targetPort : 6379
      protocol :   TCP
      name :       redis-port
  selector :
    app : redis
  type : NodePort
---
apiVersion : v1
kind :       Service
metadata :
  name :      mysql-service
  labels :
    app : mysql
  namespace : kopring-ns
spec :
  ports :
    - port :       3306
      targetPort : 3306
      protocol :   TCP
      name :       msyql-port
  selector :
    app : mysql
  type : NodePort

---
# spring
apiVersion : apps/v1
kind :       Deployment
metadata :
  name :      kopring-back-deployment
  labels :
    app : kopring-back
  namespace : kopring-ns
spec :
  selector :
    matchLabels :
      app : kopring-back
  template :
    metadata :
      labels :
        app : kopring-back
    spec :
      restartPolicy : Always
      containers :
        - name :            kopring
          image :           albaneo0724/kopring-back
          ports :
            - containerPort : 8080
          imagePullPolicy : Always
          env:
            - name: SPRING_DATASOURCE_URL
              value: "jdbc:mysql://mysql-service:3306/kopringdb"
---
# mysql
apiVersion : apps/v1
kind :       Deployment
metadata :
  name :      mysql-deployment
  labels :
    app : mysql
  namespace : kopring-ns
spec :
  replicas : 1
  selector :
    matchLabels :
      app : mysql
  template :
    metadata :
      labels :
        app : mysql
    spec :
      hostname : mysql-host
      containers :
        - name :  kopring-mysql
          image : mysql
          ports :
            - containerPort : 3306
          env :
            - name :  MYSQL_ROOT_PASSWORD
              value : root
            - name :  MYSQL_DATABASE
              value : kopringdb
---
# redis
apiVersion : apps/v1
kind :       Deployment
metadata :
  name :      redis-deployment
  labels :
    app : redis
  namespace : kopring-ns
spec :
  replicas : 1
  selector :
    matchLabels :
      app : redis
  template :
    metadata :
      labels :
        app : redis
    spec :
      hostname : redis-host
      containers :
        - name :  kopring-redis
          image : redis
          ports :
            - containerPort : 6379